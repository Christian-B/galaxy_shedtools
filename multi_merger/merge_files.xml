<tool id="file_merge" name="Merge txt files into a tabular" version="0.0.1">
    <description>merges txt files together</description>
    <stdio>
        <exit_code range="1:" />
        <exit_code range=":-1" />
        <regex match="Error:" />
        <regex match="Exception:" />
    </stdio>
    <command interpreter="python">
        merge_files.py 
        #for $input in $inputs
            --file_path=$input 
        #end for
        --names_path=$names_path
        --target_path=$output 
        #if $divider.type=="user"
            --divider $divider.specific
        #else
            --divider $divider.type
        #end if
        #if $na_value
            --na_value $na_value
        #end if
            --sort $sort.order
    </command>
    <inputs>
        <param name="inputs" type="data" format="txt" multiple="True" label="Files to merge" />
        <param name="names_path" type="data" format="txt" label="File with the names of the files being merged." />
        <conditional name="divider">
            <param name="type" type="select" label="Divider for the data" help="Select the divider between labels and data. White space is trimmed after splitting on divider.">
                <option value="__9__"  selected="true">Tab</option>
                <option value="__124__">Vertical bar.</option>
                <option value="user">User specified.</option>
            </param>
            <when value="__9__" />
            <when value="__124__" />
            <when value="user" >
                <param name="specific" type="text" value="" label="Divider to be used.  Note: Special characters can be entered as __asci__" />
            </when>
        </conditional>
        <conditional name="sort">
            <param name="order" type="select" label="Select how to sort the data" help="Allows the data to be sorted">
                <option value="none"  selected="true">Keep data in the input order.</option>
                <option value="column_names">Sort the data by column names. Remember column names are the unique parts of the input file names</option>
                <option value="row_names">Sort the data by row names. Remember row names are part before the divieder in each line</option>
                <option value="both">Sort by both column and rows names.</option>
            </param>
            <when value="none" />
            <when value="column_names" />
            <when value="row_names" />
            <when value="both" />
        </conditional>
        <param name="na_value" type="text" value="" label="Na Value to be used when not every row name/ part before the divider is found in very file." />
    </inputs>
    <outputs>
        <data name="output" format="tabular" />
    </outputs>
    <tests>
        <test>
            <param name="inputs" value="C03/htseq_count.txt,C01/htseq_count.txt,C02/htseq_count.txt,C05/htseq_count.txt" ftype="txt" /> 
            <param name="names_path" value="names.txt" ftype="txt" /> 
            <param name="divider|type" value="__9__" />
            <output name="output" file="merged.tsv" ftype="tabular" />
        </test>
        <test>
            <param name="inputs" value="C03/htseq_count.txt,C01/htseq_count.txt,C02/htseq_count.txt,C05/htseq_count.txt" ftype="txt" /> 
            <param name="names_path" value="names.txt" ftype="txt" /> 
            <param name="divider|type" value="__9__" />
            <param name="sort|order" value="both" />
            <output name="output" file="sorted_merged.tsv" ftype="tabular" />
        </test>
        <test>
            <param name="inputs" value="C03/htseq_count.txt,C01/htseq_count.txt,C02/htseq_count.txt,C05/htseq_count.txt" ftype="txt" /> 
            <param name="names_path" value="names.txt" ftype="txt" /> 
            <param name="divider|type" value="user" />
            <param name="divider|specific" value="__9__" />
            <output name="output" file="merged.tsv" ftype="tabular" />
        </test>
        <test>
            <param name="inputs" value="C43_TAAGGCGA-CTAAGCCT_L003_/Log.final.out,C08_CGTACTAG-CTCTCTAT_L003_/Log.final.out,C62_GGACTCCT-TATCCTCT_L003_/Log.final.out" ftype="txt" /> 
            <param name="names_path" value="log_names.txt" ftype="txt" /> 
            <param name="divider|type" value="user" />
            <param name="divider|specific" value="__124__" />
            <output name="output" file="log_merged_no_na.tsv" ftype="tabular" />
        </test>
        <test>
            <param name="inputs" value="C43_TAAGGCGA-CTAAGCCT_L003_/Log.final.out,C08_CGTACTAG-CTCTCTAT_L003_/Log.final.out,C62_GGACTCCT-TATCCTCT_L003_/Log.final.out" ftype="txt" /> 
            <param name="names_path" value="log_names.txt" ftype="txt" /> 
            <param name="divider|type" value="user" />
            <param name="divider|specific" value="__124__" />
            <param name="na_value" value="0" />
            <output name="output" file="log_merged.tsv" ftype="tabular" />
        </test>
    </tests>
    <help>
<![CDATA[
**What it does**

Merges various files into a single tabular files based on a divider.

For each line in each file that has the divider
The stuff on the left of the divider is considered the lables on the right the data.

This data is then put into a large tabular file with the row names being the file names, the column names the labels.
]]>
    </help>
    <citations>
    </citations>
</tool>


