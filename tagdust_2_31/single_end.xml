<tool id="tagdust_single_end" name="Tagdust single end processor" version="0.1.1">
    <description>Runs tagdust in single end mode</description>
    <requirements>
        <requirement type="package" version="2.31">tagdust</requirement>
    </requirements>
    <stdio>
        <exit_code range="1" level="fatal" description="Error code 1 occurred" />
        <exit_code range="2:255" level="fatal" description="Unknown error occurred" />
    </stdio>
    <command >
        cp $fastq_file input.fastq ;
        mkdir output ;
        tagdust -t8 -o output/data 
        #for $i, $building in enumerate( $hmm, 1 )
            -$i ${building.block}
        #end for
        input.fastq ;
        ls -al output 
    </command>
    <inputs>
        <param name="fastq_file" type="data" format="fastq" label="Single Fastq file to process" />
        <repeat name="hmm" title="HMM Building Blocks">
            <param name="block" type="text" size="25" label="Next HMM Building block (Note: Barcode/Index currently not supported)" />
        </repeat>
    </inputs>
    <outputs>
        <data format="txt" name="logfile" label="The tagdust log output for ${fastq_file.name}." from_work_dir="output/data_logfile.txt"/>
        <data format="fastq" name="extracted" label="The tagdust extracted reads from ${fastq_file.name}." from_work_dir="output/data.fq"/>
        <data format="fastq" name="unextracted" label="The tagdust un-extracted reads from ${fastq_file.name}." from_work_dir="output/data_un.fq"/>
    </outputs>
    <tests>
        <test>
            <param name="fastq_file" value="C75_S29_R1_001.fastq" ftype="fastq" /> 
            <param name="hmm_0|block" value="F:NNNNNNNN"/>
            <param name="hmm_1|block" value="S:TATAGGG"/>
            <param name="hmm_2|block" value="R:N"/>
            <output name="logfile" >
                <assert_contents>
                    <has_text text="Determining threshold for read0." />
                 </assert_contents>
            </output>
            <output name="extracted" file="C75_S29_R1_001.fq" compare="sim_size" delta="10000"/>
            <output name="unextracted" file="C75_S29_R1_001_un.fq"  compare="sim_size" delta="10000"/>
        </test>
    </tests>
    <help>
<![CDATA[
    Runs Tagdust 2.13 (see http://tagdust.sourceforge.net)

    This tool processes a single end.

    Example HMM BUilding blocks are:
        F:NNNNNNNN
        S:TATAGGG
        R:N
]]>
    </help>
    <citations>
    </citations>

</tool>
