<tool id="clean_data_script" name="clean_data_script" version="0.1">
    <description>Extracts data and plots it using R</description>
    <requirements>
        <requirement type="package" version="3.2.1">R</requirement>
        <requirement type="package" version="0.0.1">R_repr</requirement>
    </requirements>  
    <stdio>
        <exit_code range="1" level="fatal" description="Error code 1 occurred" />
        <exit_code range="2:255" level="fatal" description="Unknown error occurred" />
    </stdio>

    <command   interpreter="bash">
    r_wrapper.sh $__tool_directory__/clean_data.R --script_dir=$__tool_directory__  
        --input_file=$xls_file 
        --input_file_format=excell 
        --input_headerless
        #if $raw_tsv.save=="yes"
            --raw_rewrite_file=$raw_tsv_file 
            --raw_rewrite_format=tsv
        #end if
        --ignore_rows=$ignore_rows 
        #if $meta_data.save=="yes"
            --meta_data_file=$meta_data_file --debug
        #end if
        --names_rows=$names_row  
        --data_output_file=$tsv_output_file 
        --data_output_format=tsv
        --verbose
    </command>
    <inputs>
        <param format="xlsx" type="data" name="xls_file" label="xls input file" />
        <conditional name="raw_tsv">
            <param name="save" type="select" label="Save the raw data before trimming or header fixing?" help="">
                <option value="no">no</option>
                <option value="yes">yes</option>
            </param>
            <when value="no"/>
            <when value="yes"/>
        </conditional>
        <param name="ignore_rows" size="4" type="integer" value="0" min="0" label="Top Lines to consider metadata / ignored. (including blanks)." />
        <conditional name="meta_data">
            <param name="save" type="select" label="Save the ignored rows as meta_data?" help="">
                <option value="no">no</option>
                <option value="yes">yes</option>
            </param>
            <when value="no"/>
            <when value="yes"/>
        </conditional>
        <param name="names_row" size="4" type="integer" value="1" min="0" label="Number of lines (under ignore) to considered header/ column names lines." />
    </inputs>
    <outputs>
        <data format="tabular" type="data" name="tsv_output_file" label="Transformed Data"/>
        <data format="tabular" type="data" name="raw_tsv_file" label="Raw data in tsv format">
            <filter>(raw_tsv['save'] == 'yes')</filter>
        </data>
        <data format="tabular" type="data" name="meta_data_file" label="Lines stripped of the top assumed to be Meta Data">
            <filter>(meta_data['save'] == 'yes')</filter>
        </data>
    </outputs>
    <tests>
        <test>
            <param name="xls_file" value="mini.xlsx" />
            <param name="raw_tsv|save" value="yes"/>
            <param name="ignore_rows" value="9"/>
            <param name="names_row" value="3"/>
            <param name="meta_data|save" value="yes"/>
            <output name="output_file" file="mini_cleaned.tsv" />
            <output name="raw_tsv_file" file="mini_raw.tsv" />
            <output name="meta_data_file" file="mini_meta_data.tsv" />
        </test>
        <test>
            <param name="xls_file" value="mini_simple.xlsx" />
            <param name="raw_tsv|save" value="yes"/>
            <param name="names_row" value="1"/>
            <param name="meta_data|save" value="no"/>
            <output name="output_file" file="mini_simple_cleaned.tsv" />
            <output name="raw_tsv_file" file="mini_simple_raw.tsv" />
        </test>
    </tests>
    <help>
<![CDATA[
Converts data from xls(s) fromat into tsv. Then allows the top rows to to stripped of as metadata or just ignored. Finaly the next few rows can be combined into column headers.
]]>
    </help>
    <citations>
    </citations>

</tool>
