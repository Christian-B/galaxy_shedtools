<tool id="do_graph_script" name="do_graph_script" version="0.1">
    <description>Extracts data and plots it using R</description>
    <requirements>
        <requirement type="package" version="3.2.1">R</requirement>
        <requirement type="package" version="0.0.1">R_repr</requirement>
        </requirements>  
    <stdio>
        <exit_code range="1" level="fatal" description="Error code 1 occurred" />
        <exit_code range="2:255" level="fatal" description="Unknown error occurred" />
    </stdio>        
    <command interpreter="bash">
    r_wrapper.sh $__tool_directory__/do_graph.R --script_dir=$__tool_directory__  
        --input_file=$input_file
        #if $input_na
            --input_na=$input_na
        #end if 

        --graph_file=$graph_file
        --graph_height=$graph_height
        --graph_width=$graph_width
        #if $redline.apply=="Yes"
            --graph_red_line_value=$redline.level
        #end if
        #if $graph_title
            --graph_title="$graph_title"
        #end if
        #if $graph_y_label
            --graph_y_label="$graph_y_label"
        #end if
        --graph_format $graph_format
        --debug
    </command>
    <inputs>
        <param type="data" format="tabular" name="input_file" label="input file" />
        <param name="input_na" type="text" value="NA" label="Value to be considered NA in input file." />

        <param name="graph_height" size="4" type="integer" value="10" min="1" label="Height of the graph" />
        <param name="graph_width" size="4" type="integer" value="10" min="1" label="Height of the graph" />
        <param name="graph_title" size="30" type="text" value="" label="Title for the graph."/>
        <param name="graph_y_label" size="30" type="text" value="" label="Label for the y axis in the graph."/>
        <param name="" size="4" type="integer" value="25" label="Possition of a red horizontal line" />
        <conditional name="redline">
            <param name="apply" type="select" label="Add a red horizontal line to the graph" help="">
                <option value="Yes">Yes</option>
                <option value="No" selected="true">No</option>
            </param>
            <when value="Yes">
                <param name="level" type="integer" value="0" label="Level to draw the red horizontal line at." />
            </when>
            <when value="No">
            </when>
        </conditional>
        <param name="graph_format" type="select" label="Format for the graph" help="">
            <option value="jpeg" selected="true">jpeg</option>
            <option value="bmp">bmp</option>
            <option value="png">png</option>
            <option value="tiff">tiff</option>
            <option value="ps">ps</option>
        </param>
              
    </inputs>
    <outputs>
        <data format="jpg" type="data" name="graph_file" label="Graph">
        </data>
    </outputs>

    <tests>
         <test>
            <param name="input_file" value="mini_extracted.tsv" />
            <param name="input_na" value="999" />
            <output name="graph_file" file="mini_graph_10.jpeg" compare="sim_size" delta="1000"/>
        </test>
         <test>
            <param name="input_file" value="mini_extracted.tsv" />
            <param name="input_na" value="999" />
            <param name="graph_format" value="ps" />
            <output name="graph_file" file="mini_graph_10.ps" />
        </test>
        <test>
            <param name="input_file" value="mini_extracted.tsv" />
            <param name="input_na" value="999" />
            <param name="graph_title" value="Fancy Graph Title"/>
            <param name="graph_height" value="15"/>
            <param name="graph_width" value="15"/>
            <param name="graph_y_label" value="Y Label"/>
            <param name="redline|apply" value="Yes"/>
            <param name="redline|level" value="2"/>
            <param name="graph_format" value="ps" />
            <output name="graph_file" file="mini_graph_15.ps" />
        </test>
    </tests>

    <help>
<![CDATA[
Plots data to a graph
]]>
    </help>
    <citations>
    </citations>

</tool>
